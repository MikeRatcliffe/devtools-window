<?xml version="1.0" encoding="UTF-8"?>
<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->

<!DOCTYPE html [
<!ENTITY % connectionDTD SYSTEM "chrome://browser/locale/devtools/connection-screen.dtd" >
 %connectionDTD;
]>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
  <head>
    <title>&title;</title>

    <link rel="stylesheet" href="chrome://browser/content/devtools/connection-screen/connection.css" type="text/css"/>

    <script type="application/javascript;version=1.8">
    <![CDATA[
      function getActors(host, port, callback) {
        // FIXME
        setTimeout(function() {
            callback(null, [
              {id: "a1", title: "tab 1 :D"},
              {id: "a2", title: "tab 2, yes!"},
              {id: "a3", title: "tab 3, booooring"},
              {id: "a4", title: "tab 4, I don't know what to write"},
              {id: "a5", title: "tab 5, BOON BBOOM"},
              {id: "a6", title: "tab 5, the last one"},
            ]);
        }, 3000);
      }

      function submit() {
        let host = document.getElementById("host").value;
        let port = document.getElementById("port").value;

        document.body.classList.add("connecting");

        getActors(host, port, function(error, actors) {
            document.body.classList.remove("connecting");
            if (error) {
              alert(error);
              return;
            }
            document.body.classList.add("actors-mode");

            let parent = document.getElementById("actors");

            let focusSet = false;
            for (let actor of actors) {
              let a = document.createElement("a");
              a.onclick = function() {
                connect(actor);
              }

              a.textContent = actor.title;
              a.title = actor.title;
              a.href = "#";

              parent.appendChild(a);

              if (!focusSet) {
                a.focus();
                focusSet = true;
              }
            }
        });
      }

      function connect(actor) {
        const Cu = Components.utils;
        Cu.import("resource:///modules/devtools/gDevTools.jsm");
        // FIXME!!!
        gDevTools.
        window.close();
      }
    ]]>
    </script>
  </head>
  <body>
    <p>
    </p>
    <section id="connection-form">
      <form onsubmit="window.submit()" action="#">
        <label>
          <span>&host;</span>
          <input id="host" type="text" placeholder="127.0.0.1"></input>
        </label>
        <label>
          <span>&port;</span>
          <input id="port" type="number" placeholder="6000"></input>
        </label>
        <label>
          <input id="submit" type="submit" value="&connect;"></input>
        </label>
      </form>
    </section>

    <section id="actors-list">
      <p>&availability;</p>
      <ul id="actors"></ul>
    </section>

    <section id="connecting">
      <p>&connecting;</p>
      <div id="throbber"></div>
    </section>
  </body>
</html>
